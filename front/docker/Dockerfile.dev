FROM node:24.12-alpine

RUN corepack enable && corepack prepare pnpm@9.15.2 --activate

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"

RUN apk add --no-cache \
    git \
    python3 \
    make \
    g++

RUN addgroup -g 1000 devuser && \
    adduser -D -u 1000 -G devuser devuser

WORKDIR /app

RUN chown -R devuser:devuser /app

USER devuser

EXPOSE 3000
EXPOSE 24678

CMD ["sh", "-c", "pnpm install && pnpm dev"]
